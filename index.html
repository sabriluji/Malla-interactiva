<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ingeniería en Ciencia de Datos (UNITEC)</title>
  <!-- Evitar caché para que veas cambios al instante en GitHub Pages -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root {
      /* Tema rosa */
      --bg: #ffe9f4;           /* fondo */
      --card: #ffffff;         /* tarjeta */
      --muted: #555;           /* texto suave */
      --text: #333;            /* texto normal */
      --accent: #d598a3;       /* acento */
      --ok: #d598a3;           /* aprobado */
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; height: 100%; background: var(--bg); color: var(--text); font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    header { padding: 22px 20px 14px; display: grid; gap: 10px; align-items: center; justify-items: center; border-bottom: 1px solid #e5c2ce; }
    .title{ text-align:center; font-size: 36px; line-height:1.2; margin: 0; font-weight: 800; }

    /* Barra de progreso con los 3 colores: #ffe9f4, #d598a3, #9cabc8 */
    .progress-wrap{ width:100%; max-width: 980px; margin: 4px auto 0; display:flex; flex-direction:column; gap:6px; align-items:center; }
    .progress-bar{ position:relative; height:14px; width:100%; border-radius:999px; overflow:hidden; border:1px solid #d598a3; background:#FEE3DF55; }
    .progress-bar::before{ content:""; position:absolute; inset:0; width:var(--w,0%); transition: width .25s ease; background: repeating-linear-gradient(90deg,
        #9cabc8 40px 60px
      ); }
    .progress-label{ font-size:12px; color: var(--muted); }

    .controls { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
    button, select { background: #f7d8e6; color: var(--text); border: 1px solid #d598a3; padding: 8px 10px; border-radius: 10px; cursor: pointer; }
    button:hover { border-color: var(--accent); background: #f0cbd9; }

    .grid { display: grid; grid-template-columns: repeat(4, minmax(260px, 1fr)); gap: 14px; padding: 18px; }
    @media (max-width: 1200px) { .grid { grid-template-columns: repeat(3, minmax(260px, 1fr)); } }
    @media (max-width: 900px) { .grid { grid-template-columns: repeat(2, minmax(260px, 1fr)); } }
    @media (max-width: 620px) { .grid { grid-template-columns: 1fr; } }

    .col { background: transparent; border: 1px dashed #d598a3; border-radius: 14px; padding: 10px; }
    .col h2 { margin: 4px 6px 10px; font-size: 15px; color: var(--muted); font-weight: 700; text-align:center; }

    .course { background: var(--card); border: 1px solid #d598a3; border-radius: 12px; padding: 10px; margin: 8px; position: relative; transition: transform .12s ease, border-color .12s ease, background-color .12s ease, color .12s ease; }
    .course:hover { transform: translateY(-1px); border-color: var(--accent); }
    .course.approved { background: #d598a3; color: #ffffff; }

    .course .name { font-weight: 700; margin-bottom: 6px; }
    .course .meta { font-size: 12px; color: var(--muted); display: flex; gap: 8px; flex-wrap: wrap; }
    .course.approved .meta { color: #fff; opacity: .9; }

    .badge { display: inline-block; font-size: 11px; background: #f0cbd9; border: 1px solid #d598a3; color: #333; padding: 2px 6px; border-radius: 999px; }

    .foot { padding: 12px 18px 22px; color: var(--muted); font-size: 12px; text-align:center; }
    a { color: var(--accent); }
    .hint { font-size: 12px; color: var(--muted); }

    /* Campo de nota por materia */
    .grade-row { display:flex; align-items:center; gap:8px; margin-top:8px; }
    .grade-input {
      width: 88px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #d598a3;
      background: #ffffff;
      color: #333;
      font-size: 13px;
    }
    .course.approved .grade-input {
      background: #ffffff;
      color: #333;
      border-color: #ffffff;
    }
    /* Estado en curso (no debe sobreescribir aprobado) */
    .course.in-progress:not(.approved) {
      background: #AFB3CB;
      border-color: #AFB3CB;
    }
  </style>
</head>
<body>
  <header>
    <h1 class="title">Ingeniería en Ciencia de Datos (UNITEC)</h1>
    <div class="progress-wrap" aria-label="Progreso del plan de estudios">
      <div class="progress-bar" id="progressBar"></div>
      <div class="progress-label" id="progressLabel">Aprobadas: 0% (0%)</div>
    </div>
    <div class="controls">
      <select id="filter" aria-label="Filtro de materias">
        <option value="all">Mostrar todo</option>
        <option value="pending">Solo pendientes</option>
        <option value="approved">Solo aprobadas</option>
      </select>
      <button id="clear">Borrar progreso</button>
      <span class="hint">Escribe la nota (6–10) en la materia para marcarla como aprobada.</span>
    </div>
  </header>

  <main class="grid" id="grid"></main>

  <div class="foot">
    <p>Estado guardado en <strong>este navegador</strong> (localStorage). Puedes publicar este archivo como <em>GitHub Pages</em> sin backend.</p>
  </div>

  <script>
    // === Plan por cuatrimestre ===
    const PLAN = {
      1: [
        { nombre: "fundamentos de ciencia de datos" },
        { nombre: "geometría analítica vectorial en 2D" },
        { nombre: "Álgebra para ciencias" },
        { nombre: "Comunicación oral y escrita" },
        { nombre: "Inglés I" }
      ],
      2: [
        { nombre: "Matemáticas discretas" },
        { nombre: "Cálculo diferencial para ciencias" },
        { nombre: "Espacios y transformaciones lineales" },
        { nombre: "Geometría analítica vectorial en 3D" },
        { nombre: "Inglés II" }
      ],
      3: [
        { nombre: "Fundamentos de programación" },
        { nombre: "Cálculo integral para ciencias" },
        { nombre: "Pensamiento para el diseño e innovación" },
        { nombre: "Ciencia y técnica con humanismo" },
        { nombre: "Inglés III" }
      ],
      4: [
        { nombre: "Estructura de datos" },
        { nombre: "Cálculo en varias variables" },
        { nombre: "Modelos probabilísticos" },
        { nombre: "Responsabilidad social y sustentabilidad" },
        { nombre: "Inglés IV" }
      ],
      5: [
        { nombre: "Programación avanzada" },
        { nombre: "Ecuaciones diferenciales" },
        { nombre: "Modelos estadísticos" },
        { nombre: "Comunicación y visualización de datos" },
        { nombre: "Inglés V" }
      ],
      6: [
        { nombre: "Modelos de bases de datos" },
        { nombre: "Métodos numéricos" },
        { nombre: "Modelos estadísticos avanzados" },
        { nombre: "Modelado computacional" },
        { nombre: "Inglés VI" }
      ],
      7: [
        { nombre: "Gestión de bases de datos" },
        { nombre: "Procesos estocásticos" },
        { nombre: "Modelado y analítica de datos" },
        { nombre: "Sistemas no lineales" },
        { nombre: "Estrategia y modelos de negocio" }
      ],
      8: [
        { nombre: "Programación para ciencia de datos" },
        { nombre: "Ingeniería de requerimientos" },
        { nombre: "Modelado y analítica de datos avanzada" },
        { nombre: "Sistemas complejos" },
        { nombre: "Investigación de operaciones y optimización" }
      ],
      9: [
        { nombre: "Programación para ciencia de datos avanzada" },
        { nombre: "Inteligencia artificial" },
        { nombre: "Bases de datos no relacionales" },
        { nombre: "Cómputo en la nube" }
      ],
      10: [
        { nombre: "Internet de las cosas" },
        { nombre: "Aprendizaje automático" },
        { nombre: "Manejo de grandes volúmenes de datos" },
        { nombre: "Ingeniería de aplicaciones para ciencia de datos" }
      ],
      11: [
        { nombre: "Ciencia de datos en el sector público" },
        { nombre: "Procesamiento de lenguaje natural" },
        { nombre: "Redes neuronales" },
        { nombre: "Gestión de proyectos de tecnología" }
      ],
      12: [
        { nombre: "Seguridad de tecnología de información" },
        { nombre: "Ciencia de datos en el sector privado" },
        { nombre: "Aprendizaje profundo" },
        { nombre: "Cómputo paralelo" }
      ]
    };

    // === Persistencia local ===
    const KEY = "malla_unitec_progress_v1";
    const saved = JSON.parse(localStorage.getItem(KEY) || "{}");
    // Estructura: saved[curso] = { approved: boolean, grade: number|null, inProgress: boolean }
    function migrateSaved(){
      let changed = false;
      const allNames = Object.values(PLAN).flat().map(c => c.nombre);
      for(const name of allNames){
        const v = saved[name];
        if(typeof v === 'boolean'){
          saved[name] = v ? { approved: true, grade: 6, inProgress: false } : { approved: false, grade: null, inProgress: false };
          changed = true;
        } else if(v && typeof v === 'object'){
          if(typeof v.approved !== 'boolean'){ v.approved = Boolean(v.grade && v.grade >= 6 && v.grade <= 10); changed = true; }
          if(!('grade' in v)) { v.grade = null; changed = true; }
          if(!('inProgress' in v)) { v.inProgress = false; changed = true; }
        }
      }
      if(changed){ localStorage.setItem(KEY, JSON.stringify(saved)); }
    }
    migrateSaved();
    function isApproved(name){
      const v = saved[name];
      if(v && typeof v === 'object') return Boolean(v.approved);
      return Boolean(v);
    }
    function getGrade(name){
      const v = saved[name];
      return (v && typeof v === 'object') ? (v.grade ?? null) : null;
    }
    function setGradeAndStatus(name, gradeValue){
      const prev = (saved[name] && typeof saved[name] === 'object') ? saved[name] : { inProgress: false };
      const isEmpty = gradeValue === '' || gradeValue === null || Number.isNaN(Number(gradeValue));
      let grade = null;
      let approved = false;
      if(!isEmpty){
        const n = parseFloat(String(gradeValue).replace(',', '.'));
        if(!Number.isNaN(n)){ grade = n; approved = n >= 6 && n <= 10; }
      }
      saved[name] = { ...prev, approved, grade };
      localStorage.setItem(KEY, JSON.stringify(saved));
    }
    function isInProgress(name){
      const v = saved[name];
      return (v && typeof v === 'object') ? Boolean(v.inProgress) : false;
    }
    function toggleInProgress(name){
      const prev = (saved[name] && typeof saved[name] === 'object') ? saved[name] : { approved: false, grade: null, inProgress: false };
      const next = !prev.inProgress;
      saved[name] = { ...prev, inProgress: next };
      localStorage.setItem(KEY, JSON.stringify(saved));
      return next;
    }
    function updateProgress(){
      let total = 0; let done = 0; let inProgNotApproved = 0;
      let gradesCount = 0; let gradesSum = 0;
      for(const cuatri of Object.keys(PLAN)){
        const cursosAll = PLAN[cuatri];
        total += cursosAll.length;
        for(const c of cursosAll){
          const approved = isApproved(c.nombre);
          const inProg = isInProgress(c.nombre);
          if(approved) done++;
          else if(inProg) inProgNotApproved++;
          const g = getGrade(c.nombre);
          if(typeof g === 'number' && !Number.isNaN(g)){
            gradesCount++;
            gradesSum += g;
          }
        }
      }
      const pct = total ? Math.round((done/total)*100) : 0;
      const pctEst = total ? Math.round(((done + inProgNotApproved)/total)*100) : 0;
      const avg = gradesCount ? (gradesSum / gradesCount) : null;
      const bar = document.getElementById('progressBar');
      const label = document.getElementById('progressLabel');
      bar.style.setProperty('--w', pct + '%');
      label.textContent = `Aprobadas: ${pct}% (${pctEst}%${avg !== null ? ` · Prom: ${avg.toFixed(1)}` : ''})`;
    }

    // === Render ===
    const grid = document.getElementById('grid');
    const filter = document.getElementById('filter');

    function courseCard(course){
      const div = document.createElement('div');
      div.className = 'course' + (isApproved(course.nombre) ? ' approved' : '') + (isInProgress(course.nombre) ? ' in-progress' : '');
      div.tabIndex = 0;
      div.role = 'group';
      div.title = 'Ingresa la nota para marcar como aprobada. Clic en la tarjeta para “en curso”.'
      ;
      div.addEventListener('click', (e) => {
        if(e.target && e.target.closest && e.target.closest('.grade-input')) return;
        const on = toggleInProgress(course.nombre);
        div.classList.toggle('in-progress', on);
        updateProgress();
      });

      const name = document.createElement('div');
      name.className = 'name';
      name.textContent = course.nombre;

      const meta = document.createElement('div');
      meta.className = 'meta';
      if(course.creditos) meta.innerHTML += `<span class="badge">${course.creditos} créditos</span>`;
      if(course.prerrequisitos?.length) meta.innerHTML += `<span class="badge">Req: ${course.prerrequisitos.join(', ')}</span>`;

      // Campo de nota
      const gradeRow = document.createElement('div');
      gradeRow.className = 'grade-row';
      const input = document.createElement('input');
      input.type = 'number';
      input.inputMode = 'decimal';
      input.min = '0';
      input.max = '10';
      input.step = '0.1';
      input.placeholder = 'Nota (6–10)';
      input.className = 'grade-input';
      const currentGrade = getGrade(course.nombre);
      if(currentGrade !== null && currentGrade !== undefined){ input.value = String(currentGrade); }

      input.addEventListener('input', () => {
        const before = isApproved(course.nombre);
        const val = input.value.trim();
        setGradeAndStatus(course.nombre, val);
        const now = isApproved(course.nombre);
        div.classList.toggle('approved', now);
        if(filter.value !== 'all' && before !== now){
          render();
          return;
        }
        updateProgress();
      });

      gradeRow.appendChild(input);

      div.appendChild(name);
      if(meta.textContent) div.appendChild(meta);
      div.appendChild(gradeRow);
      return div;
    }

    function render(){
      grid.innerHTML = '';
      const mode = filter.value;
      let total = 0; let done = 0;

      for(const cuatri of Object.keys(PLAN).map(Number).sort((a,b)=>a-b)){
        const col = document.createElement('section');
        col.className = 'col';
        const h2 = document.createElement('h2');
        h2.textContent = `${cuatri}º Cuatrimestre`;
        col.appendChild(h2);

        const cursosAll = PLAN[cuatri];
        total += cursosAll.length;
        done += cursosAll.filter(c=>isApproved(c.nombre)).length;

        const cursos = cursosAll.filter(c => {
          if(mode === 'approved') return isApproved(c.nombre);
          if(mode === 'pending') return !isApproved(c.nombre);
          return true;
        });

        if(cursos.length === 0){
          const empty = document.createElement('div');
          empty.className = 'course';
          empty.innerHTML = '<span class="meta">(sin materias para este filtro)</span>';
          col.appendChild(empty);
        } else {
          for(const c of cursos){ col.appendChild(courseCard(c)); }
        }

        grid.appendChild(col);
      }

      // Actualiza la barra y etiqueta de progreso (con estimado)
      updateProgress();
    }

    document.getElementById('clear').addEventListener('click', () => {
      if(confirm('¿Borrar el progreso guardado en este navegador?')){
        localStorage.removeItem(KEY);
        location.reload();
      }
    });

    filter.addEventListener('change', render);
    render();
  </script>
</body>
</html>
